<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>Reeh Balak</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      font-family: 'Segoe UI', Tahoma, sans-serif;
      background-color: #1f2428;
      color: #d0d4d9;
      padding: 20px;
      display: flex;
      justify-content: center;
      min-height: 100vh;
      align-items: flex-start;
    }
    .container {
      width: 100%;
      max-width: 600px;
      background-color: #2a2f36;
      border-radius: 16px;
      padding: 30px 24px;
      box-shadow: 0 0 15px rgba(0,0,0,0.5);
    }
    h1 {
      margin-top: 0;
      font-weight: 900;
      font-size: 2.4rem;
      text-align: center;
      margin-bottom: 30px;
      color: #a3b1c2;
      user-select: none;
    }
    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 700;
      font-size: 1.1rem;
      color: #bfc7d1;
      user-select: none;
    }

    /* âœ… ØªØµÙ…ÙŠÙ… Ø­Ù‚Ù„ Ø§Ø³Ù… Ø§Ù„ØµÙ Ø¨Ø´ÙƒÙ„ Ø£ÙˆØ¶Ø­ */
    #className {
      width: 100%;
      padding: 16px 18px;
      border-radius: 16px;
      border: 2px solid #5a6570;
      font-size: 1.3rem;
      font-weight: 700;
      background-color: #3b424b;
      color: #d0d4d9;
      margin-bottom: 14px;
      transition: border-color 0.3s ease, background-color 0.3s ease;
      user-select: text;
      outline: none;
    }
    #className:focus {
      border-color: #8ca1b7;
      background-color: #454f5a;
      color: #e1e6ef;
    }

    input[name="subjName"] {
      width: 100%;
      padding: 16px 18px;
      border-radius: 16px;
      border: 2px solid #5a6570;
      font-size: 1.3rem;
      font-weight: 700;
      background-color: #3b424b;
      color: #d0d4d9;
      margin-bottom: 14px;
      transition: border-color 0.3s ease, background-color 0.3s ease;
      user-select: text;
      outline: none;
    }
    input[name="subjName"]:focus {
      border-color: #8ca1b7;
      background-color: #454f5a;
      color: #e1e6ef;
    }

    .card {
      background-color: #343c47;
      border-radius: 14px;
      padding: 18px 20px;
      margin-bottom: 25px;
      box-shadow: inset 0 0 8px rgba(255,255,255,0.05);
      user-select: none;
    }
    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }
    .card-header h2 {
      margin: 0;
      font-size: 1.3rem;
      font-weight: 700;
      color: #a3b1c2;
      user-select: text;
    }
    .card-header button {
      background-color: #7a8ba6;
      border: none;
      color: white;
      padding: 8px 14px;
      border-radius: 10px;
      cursor: pointer;
      font-size: 1rem;
      font-weight: 700;
      user-select: none;
    }
    .card-header button:hover {
      background-color: #7a8ba6;
    }
    .images {
      margin-top: 12px;
      margin-bottom: 14px;
    }
    .image-row {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
      flex-wrap: wrap;
    }
    .image-row img {
      width: 60px;
      height: 60px;
      object-fit: cover;
      border-radius: 10px;
      box-shadow: 0 0 5px rgba(140,161,183,0.5);
      flex-shrink: 0;
      user-select: none;
    }
    .custom-upload {
      background-color: #7a8ba6;
      color: #d0d4d9;
      padding: 10px 22px;
      border-radius: 14px;
      cursor: pointer;
      font-size: 1rem;
      font-weight: 700;
      user-select: none;
      display: inline-block;
    }
    .custom-upload:hover {
      background-color: #7a8ba6;
    }
    .image-row .status {
      font-size: 22px;
      color: #a3b1c2;
      margin-left: auto;
      user-select: none;
    }
    .image-row button.remove-img {
      background-color: #b86b6b;
      border: none;
      color: white;
      font-weight: 700;
      border-radius: 50%;
      width: 30px;
      height: 30px;
      cursor: pointer;
      display: flex;
      justify-content: center;
      align-items: center;
      margin-left: 6px;
      user-select: none;
    }
    .image-row button.remove-img:hover {
      background-color: #b86b6b;
    }
    #controls {
      display: flex;
      gap: 16px;
      flex-wrap: wrap;
      justify-content: center;
      margin-top: 32px;
      user-select: none;
    }
    .btn {
      background-color: #7a8ba6;
      color: #d0d4d9;
      padding: 16px 26px;
      border: none;
      border-radius: 16px;
      cursor: pointer;
      font-size: 1.15rem;
      font-weight: 700;
      min-width: 160px;
      text-align: center;
      user-select: none;
    }
    .btn:hover {
      background-color: #7a8ba6;
    }
    #message {
      margin-top: 24px;
      text-align: center;
      white-space: pre-line;
      color: #b86b6b;
      font-weight: 700;
      min-height: 28px;
      font-size: 1.15rem;
      user-select: none;
    }
    @media (max-width: 520px) {
      body {
        padding: 14px 10px;
      }
      .container {
        padding: 24px 18px;
      }
      h1 {
        font-size: 2rem;
        margin-bottom: 24px;
      }
      #className,
      input[name="subjName"] {
        font-size: 1.1rem;
        padding: 14px 16px;
        border-radius: 14px;
      }
      .card-header h2 {
        font-size: 1.1rem;
      }
      .card-header button {
        padding: 6px 12px;
        font-size: 0.95rem;
      }
      .image-row img {
        width: 50px;
        height: 50px;
      }
      .custom-upload {
        padding: 8px 20px;
        font-size: 0.95rem;
        border-radius: 12px;
      }
      #controls {
        gap: 12px;
      }
      .btn {
        font-size: 1rem;
        padding: 14px 20px;
        min-width: 140px;
        border-radius: 14px;
      }
      #message {
        font-size: 1rem;
        min-height: 24px;
      }
    }
  </style>
</head>
<body>

  <div class="container">
    <h1>Ø±ÙŠØ­ Ø¨Ø§Ù„Ùƒ</h1>
    <label for="className">Ø§Ø³Ù… Ø§Ù„ØµÙ:</label>
    <input type="text" id="className" placeholder="Ù…Ø«Ø§Ù„: Ø§Ù„ØµÙ Ø§Ù„Ø³Ø§Ø¯Ø³" />

    <div id="subjects"></div>

    <div id="controls">
      <button class="btn" onclick="addSubject()">â• Ø¥Ø¶Ø§ÙØ© Ù…Ø§Ø¯Ø©</button>
      <button class="btn" onclick="copyData()">ğŸ“‹ Ù†Ø³Ø® Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
      <button class="btn" onclick="clearAll()">ğŸ—‘ï¸ Ø­Ø°Ù Ø§Ù„ÙƒÙ„</button>
    </div>

    <div id="message"></div>
  </div>

  <script>
    const IMG_BB_KEY = '0481d627cb113748d10d6a8d57be7ed0';

    function getTodayDate() {
      const d = new Date();
      return `${d.getDate()}/${d.getMonth()+1}/${d.getFullYear()}`;
    }

    function addSubject(name = '') {
      const sub = document.createElement('div');
      sub.className = 'card';
      sub.innerHTML = `
        <div class="card-header">
          <h2>Ù…Ø§Ø¯Ø©</h2>
          <button onclick="removeSubject(this)">âœ–</button>
        </div>
        <input type="text" name="subjName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø©" value="${name}" />
        <div class="images"></div>
        <button class="custom-upload" onclick="addImage(this)">â• Ø¥Ø¶Ø§ÙØ© ØµÙˆØ±Ø©</button>
      `;
      document.getElementById('subjects').appendChild(sub);

      const input = sub.querySelector('[name="subjName"]');
      input.addEventListener('input', save);

      save();
    }

    function removeSubject(btn) {
      btn.closest('.card').remove();
      save();
    }

    function addImage(btn, url = null) {
      const container = btn.previousElementSibling;
      if (container.children.length >= 10) return alert('ÙŠÙ…ÙƒÙ† Ø±ÙØ¹ 10 ØµÙˆØ± ÙƒØ­Ø¯ Ø£Ù‚ØµÙ‰');
      const row = document.createElement('div');
      row.className = 'image-row';

      if (url) {
        row.innerHTML = `
          <img src="${url}" />
          <button class="remove-img" onclick="removeImage(this)">âœ–</button>
          <span class="status">âœ…</span>
        `;
        container.appendChild(row);
        save();
        return;
      }

      row.innerHTML = `
        <img src="" hidden />
        <label class="custom-upload">
          ğŸ“ Ø§Ø®ØªØ± ØµÙˆØ±Ø©
          <input type="file" accept="image/*" hidden onchange="handleUpload(this)" />
        </label>
        <button class="remove-img" onclick="removeImage(this)">âœ–</button>
        <span class="status"></span>
      `;
      container.appendChild(row);
      save();
    }

    function removeImage(btn) {
      btn.closest('.image-row').remove();
      save();
    }

    function handleUpload(input) {
      const file = input.files[0];
      if (!file) return;
      const row = input.closest('.image-row');
      const img = row.querySelector('img');
      const st = row.querySelector('.status');

      imgbbUpload(file)
        .then(url => {
          img.src = url;
          img.hidden = false;
          st.textContent = 'âœ…';
          const label = row.querySelector('label.custom-upload');
          if (label) label.remove();
          save();
        })
        .catch(() => alert('ÙØ´Ù„ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©'));
    }

    function imgbbUpload(file) {
      return new Promise((res, rej) => {
        const fr = new FileReader();
        fr.onload = () => {
          const fd = new FormData();
          fd.append('image', fr.result.split(',')[1]);
          fetch(`https://api.imgbb.com/1/upload?key=${IMG_BB_KEY}`, {
            method: 'POST', body: fd
          }).then(r => r.json()).then(d => d.success ? res(d.data.url) : rej()).catch(rej);
        };
        fr.readAsDataURL(file);
      });
    }

    function generateJSON() {
      const cls = document.getElementById('className').value.trim();
      const cards = document.querySelectorAll('.card');
      const errors = [];

      if (!cls) errors.push('Ø§Ø³Ù… Ø§Ù„ØµÙ ÙØ§Ø±Øº');

      const subjArr = [];

      cards.forEach((c, i) => {
        const n = c.querySelector('[name="subjName"]').value.trim();
        if (!n) errors.push(`Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø© Ø±Ù‚Ù… ${i+1} ÙØ§Ø±Øº`);
        const imgs = [...c.querySelectorAll('.image-row img')].map(i => i.src).filter(Boolean);
        if (!imgs.length) errors.push(`Ø§Ù„Ù…Ø§Ø¯Ø© "${n}" Ù„Ø§ ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ ØµÙˆØ±`);

        const subjObj = {
          "Name of the subject": n,
          "the date": getTodayDate(),
        };

        imgs.forEach((url, idx) => {
          subjObj[`Image link ${idx + 1}`] = url;
        });

        subjArr.push(subjObj);
      });

      if (errors.length) {
        showMsg('ÙŠØ±Ø¬Ù‰ ØªØµØ­ÙŠØ­ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„ØªØ§Ù„ÙŠØ©:\n' + errors.join('\n'));
        return null;
      }

      return JSON.stringify([{ "class": cls }, ...subjArr], null, 2);
    }

    function copyData() {
      const js = generateJSON();
      if (!js) return;
      navigator.clipboard.writeText(js).then(() => {
        showMsg('âœ… ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­', '#7ab77a');
      });
    }

    function showMsg(m, clr = '#b86b6b') {
      const msg = document.getElementById('message');
      msg.style.color = clr;
      msg.textContent = m;
      setTimeout(() => { msg.textContent = ''; }, 4000);
    }

    function save() {
      const cls = document.getElementById('className').value;
      const subs = [...document.querySelectorAll('.card')].map(c => ({
        name: c.querySelector('[name="subjName"]').value,
        imgs: [...c.querySelectorAll('.image-row img')].map(i => i.src).filter(Boolean)
      }));
      localStorage.setItem('rb', JSON.stringify({ cls, subs }));
    }

    function load() {
      const d = JSON.parse(localStorage.getItem('rb') || '{}');
      document.getElementById('className').value = d.cls || '';
      document.getElementById('subjects').innerHTML = '';
      if (d.subs && d.subs.length) {
        d.subs.forEach(s => {
          addSubject(s.name);
          const lastCard = document.querySelector('.card:last-child');
          const btn = lastCard.querySelector('button.custom-upload');
          s.imgs.forEach(url => {
            addImage(btn, url);
          });
        });
      } else {
        addSubject();
      }
    }

    function clearAll() {
      if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ')) return;
      localStorage.removeItem('rb');
      location.reload();
    }

    window.onload = () => {
      load();
      document.getElementById('className').addEventListener('input', save);
      document.getElementById('subjects').addEventListener('input', save);
    };
  </script>

</body>
</html>
